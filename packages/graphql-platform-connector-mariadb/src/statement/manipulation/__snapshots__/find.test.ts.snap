// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`Find statement 0 - generates statements 1`] = `
[
  "SELECT JSON_OBJECT(
    "status",
    \`articles\`.\`status\`,
    "title",
    \`articles\`.\`title\`,
    "body",
    \`articles\`.\`body\`,
    "views",
    \`articles\`.\`views\`,
    "score",
    \`articles\`.\`score\`,
    "machineTags",
    \`articles\`.\`machine_tags\`,
    "metas",
    \`articles\`.\`metas\`,
    "tagCount",
    (
      SELECT COUNT(*)
      FROM \`article_tags\` AS \`articles>tags\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
    ),
    "createdAt",
    \`articles\`.\`created_at\`
  ) as \`Article\`
FROM \`articles\`
WHERE \`articles\`.\`status\` <=> 'published'
ORDER BY \`articles\`.\`created_at\` ASC
LIMIT 5",
]
`;

exports[`Find statement 1 - generates statements 1`] = `
[
  "SELECT JSON_OBJECT(
    "status",
    \`articles\`.\`status\`,
    "title",
    \`articles\`.\`title\`
  ) as \`Article\`
FROM \`articles\`
ORDER BY \`articles\`.\`created_at\` ASC
LIMIT 5",
]
`;

exports[`Find statement 2 - generates statements 1`] = `
[
  "SELECT JSON_OBJECT(
    "status",
    \`articles\`.\`status\`,
    "title",
    \`articles\`.\`title\`,
    "category",
    IF(
      \`articles>category\`.\`private_id\` IS NOT NULL,
      JSON_OBJECT("title", \`articles>category\`.\`title\`),
      NULL
    ),
    "createdBy",
    IF(
      \`articles>createdBy\`.\`id\` IS NOT NULL,
      JSON_OBJECT(
        "username",
        \`articles>createdBy\`.\`username\`,
        "profile",
        IF(
          \`articles>createdBy>profile\`.\`theUserId\` IS NOT NULL,
          JSON_OBJECT(
            "facebookId",
            \`articles>createdBy>profile\`.\`facebook_id\`,
            "googleId",
            \`articles>createdBy>profile\`.\`google_id\`,
            "twitterHandle",
            \`articles>createdBy>profile\`.\`twitter_handle\`
          ),
          NULL
        )
      ),
      NULL
    ),
    "allTagCount",
    (
      SELECT COUNT(*)
      FROM \`article_tags\` AS \`articles>tags\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
    ),
    "filteredTagCount",
    (
      SELECT COUNT(*)
      FROM \`article_tags\` AS \`articles>tags\`
        INNER JOIN \`tags\` AS \`articles>tags>tag\` ON \`articles>tags\`.\`tag_id\` <=> \`articles>tags>tag\`.\`id\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
        AND NOT (
          \`articles>tags>tag\`.\`id\` IS NOT NULL
          AND \`articles>tags>tag\`.\`deprecated\` <=> 1
        )
    ),
    "allTags",
    (
      SELECT JSON_ARRAYAGG(
          JSON_OBJECT(
            "order",
            \`articles>tags\`.\`order\`,
            "tag",
            IF(
              \`articles>tags>tag\`.\`id\` IS NOT NULL,
              JSON_OBJECT(
                "title",
                \`articles>tags>tag\`.\`title\`,
                "deprecated",
                \`articles>tags>tag\`.\`deprecated\`
              ),
              NULL
            )
          )
          ORDER BY \`articles>tags\`.\`order\` ASC
          LIMIT 5
        )
      FROM \`article_tags\` AS \`articles>tags\`
        INNER JOIN \`tags\` AS \`articles>tags>tag\` ON \`articles>tags\`.\`tag_id\` <=> \`articles>tags>tag\`.\`id\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
    ),
    "filteredTags",
    (
      SELECT JSON_ARRAYAGG(
          JSON_OBJECT(
            "order",
            \`articles>tags\`.\`order\`,
            "tag",
            IF(
              \`articles>tags>tag\`.\`id\` IS NOT NULL,
              JSON_OBJECT("title", \`articles>tags>tag\`.\`title\`),
              NULL
            )
          )
          ORDER BY \`articles>tags\`.\`order\` ASC
          LIMIT 5
        )
      FROM \`article_tags\` AS \`articles>tags\`
        INNER JOIN \`tags\` AS \`articles>tags>tag\` ON \`articles>tags\`.\`tag_id\` <=> \`articles>tags>tag\`.\`id\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
        AND NOT (
          \`articles>tags>tag\`.\`id\` IS NOT NULL
          AND \`articles>tags>tag\`.\`deprecated\` <=> 1
        )
    )
  ) as \`Article\`
FROM \`articles\`
  LEFT JOIN \`categories\` AS \`articles>category\` ON \`articles\`.\`category_private_id\` <=> \`articles>category\`.\`private_id\`
  LEFT JOIN \`users\` AS \`articles>createdBy\` ON \`articles\`.\`created_by_id\` <=> \`articles>createdBy\`.\`id\`
  LEFT JOIN \`user_profiles\` AS \`articles>createdBy>profile\` ON \`articles>createdBy\`.\`id\` <=> \`articles>createdBy>profile\`.\`theUserId\`
WHERE (
    \`articles\`.\`status\` <=> 'published'
    AND (
      \`articles>category\`.\`private_id\` IS NOT NULL
      AND \`articles>category\`.\`slug\` <=> 'tv'
    )
    AND (
      \`articles>createdBy\`.\`id\` IS NOT NULL
      AND (
        \`articles>createdBy>profile\`.\`theUserId\` IS NOT NULL
        AND (
          NOT (
            \`articles>createdBy>profile\`.\`facebook_id\` <=> NULL
          )
          OR NOT (
            \`articles>createdBy>profile\`.\`google_id\` <=> NULL
          )
          OR NOT (
            \`articles>createdBy>profile\`.\`twitter_handle\` <=> NULL
          )
        )
      )
    )
    AND \`articles\`.\`created_at\` >= '2022-01-01 00:00:00.000'
    AND EXISTS (
      SELECT *
      FROM \`article_tags\` AS \`articles>tags\`
        INNER JOIN \`tags\` AS \`articles>tags>tag\` ON \`articles>tags\`.\`tag_id\` <=> \`articles>tags>tag\`.\`id\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
        AND (
          \`articles>tags>tag\`.\`id\` IS NOT NULL
          AND NOT (\`articles>tags>tag\`.\`deprecated\` <=> 1)
        )
    )
    AND (
      SELECT COUNT(*)
      FROM \`article_tags\` AS \`articles>tags\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
    ) > 5
    AND (
      \`articles\`.\`body\` <=> NULL
      OR JSON_SEARCH(
        \`articles\`.\`body\`,
        'one',
        '%my searched text here%',
        NULL,
        '$.blocks[*].text'
      ) IS NOT NULL
      OR JSON_SEARCH(
        \`articles\`.\`body\`,
        'one',
        'my starting text here%',
        NULL,
        '$.blocks[0].text'
      ) IS NOT NULL
      OR JSON_SEARCH(
        \`articles\`.\`body\`,
        'one',
        '%my ending text here',
        NULL,
        '$.blocks[last].text'
      ) IS NOT NULL
    )
  )
ORDER BY \`articles\`.\`created_at\` ASC
LIMIT 5",
]
`;

exports[`Find statement 3 - generates statements 1`] = `
[
  "SELECT JSON_OBJECT(
    "title",
    \`articles\`.\`title\`,
    "second",
    (
      SELECT JSON_ARRAYAGG(
          JSON_OBJECT("order", \`articles>tags\`.\`order\`)
          ORDER BY \`articles>tags\`.\`order\` ASC
          LIMIT 1 OFFSET 1
        )
      FROM \`article_tags\` AS \`articles>tags\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
    ),
    "penultimate",
    (
      SELECT JSON_ARRAYAGG(
          JSON_OBJECT("order", \`articles>tags\`.\`order\`)
          ORDER BY \`articles>tags\`.\`order\` DESC
          LIMIT 1 OFFSET 1
        )
      FROM \`article_tags\` AS \`articles>tags\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
    ),
    "all",
    (
      SELECT JSON_ARRAYAGG(
          JSON_OBJECT("order", \`articles>tags\`.\`order\`)
          ORDER BY \`articles>tags\`.\`order\` ASC
          LIMIT 10
        )
      FROM \`article_tags\` AS \`articles>tags\`
      WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
    )
  ) as \`Article\`
FROM \`articles\`
WHERE (
    SELECT COUNT(*)
    FROM \`article_tags\` AS \`articles>tags\`
    WHERE \`articles\`.\`private_id\` <=> \`articles>tags\`.\`article_private_id\`
  ) > 1
ORDER BY \`articles\`.\`created_at\` ASC
LIMIT 1",
]
`;

exports[`Find statement 4 - generates statements 1`] = `
[
  "SELECT JSON_OBJECT(
    "title",
    \`categories\`.\`title\`,
    "childCount",
    (
      SELECT COUNT(*)
      FROM \`categories\` AS \`categories>children\`
      WHERE \`categories\`.\`private_id\` <=> \`categories>children\`.\`parent_private_id\`
    ),
    "children",
    (
      SELECT JSON_ARRAYAGG(
          JSON_OBJECT(
            "parent",
            IF(
              \`categories>children>parent\`.\`private_id\` IS NOT NULL,
              JSON_OBJECT("title", \`categories>children>parent\`.\`title\`),
              NULL
            ),
            "title",
            \`categories>children\`.\`title\`
          )
          LIMIT 10
        )
      FROM \`categories\` AS \`categories>children\`
        LEFT JOIN \`categories\` AS \`categories>children>parent\` ON \`categories>children\`.\`parent_private_id\` <=> \`categories>children>parent\`.\`private_id\`
      WHERE \`categories\`.\`private_id\` <=> \`categories>children\`.\`parent_private_id\`
    )
  ) as \`Category\`
FROM \`categories\`
  LEFT JOIN \`categories\` AS \`categories>parent\` ON \`categories\`.\`parent_private_id\` <=> \`categories>parent\`.\`private_id\`
WHERE NOT \`categories>parent\`.\`private_id\` IS NOT NULL
LIMIT 1",
]
`;
